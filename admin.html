<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stuff Stored</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    max-width: 800px;
    margin: 2rem auto;
    background: #f9f9f9;
    color: #222;
    padding: 1rem;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  h1 {
    font-weight: 600;
    font-size: 1.8rem;
    margin: 0;
  }
  button {
    background-color: #007aff;
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.4rem 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #005bb5;
  }
  .data-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .data-row {
    background: white;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .data-content {
    display: grid;
    grid-template-columns: max-content 1fr;
    gap: 0.3rem 1rem;
    font-size: 0.9rem;
    white-space: nowrap;
  }
  .data-content div:first-child {
    font-weight: 700;
    color: #555;
  }
  .delete-btn {
    background: #ff3b30;
    border-radius: 12px;
    font-weight: 600;
    padding: 0.25rem 0.8rem;
    font-size: 0.85rem;
  }
  .delete-btn:hover {
    background: #c1271f;
  }
  /* Confirmation popup overlay */
  #confirmOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.25);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #confirmBox {
    background: white;
    border-radius: 15px;
    padding: 1.5rem 2rem;
    width: 90%;
    max-width: 320px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    text-align: center;
    font-size: 1.1rem;
    font-weight: 500;
  }
  #confirmButtons {
    margin-top: 1.5rem;
    display: flex;
    justify-content: space-around;
  }
  #confirmButtons button {
    padding: 0.5rem 1.5rem;
    border-radius: 15px;
    font-weight: 600;
    font-size: 1rem;
  }
  #confirmYes {
    background-color: #007aff;
    color: white;
  }
  #confirmYes:hover {
    background-color: #005bb5;
  }
  #confirmNo {
    background-color: #f0f0f0;
  }
  #confirmNo:hover {
    background-color: #ccc;
  }
</style>
</head>
<body>
<header>
  <h1>Stuff Stored</h1>
  <button id="deleteAllBtn">Delete All</button>
</header>

<div class="data-list" id="dataList">
  <!-- Data rows will be appended here -->
</div>

<!-- Confirmation Popup -->
<div id="confirmOverlay">
  <div id="confirmBox">
    <div id="confirmMessage">Are you sure you want to delete this?</div>
    <div id="confirmButtons">
      <button id="confirmYes">Yes</button>
      <button id="confirmNo">No</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyApoNEdlKTIhjYyCTQTjhkdsIotxs3YaKU",
  authDomain: "ip--address-catcher-12.firebaseapp.com",
  databaseURL: "https://ip--address-catcher-12-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ip--address-catcher-12",
  storageBucket: "ip--address-catcher-12.firebasestorage.app",
  messagingSenderId: "1049666257395",
  appId: "1:1049666257395:web:a2e4418ea89ecf59511286",
  measurementId: "G-J30PRNTW1M"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const collectionRef = db.collection("userData");

  const dataList = document.getElementById("dataList");
  const deleteAllBtn = document.getElementById("deleteAllBtn");
  const confirmOverlay = document.getElementById("confirmOverlay");
  const confirmMessage = document.getElementById("confirmMessage");
  const confirmYes = document.getElementById("confirmYes");
  const confirmNo = document.getElementById("confirmNo");

  let pendingDelete = null; // will hold { type: "all" } or { type: "single", id: docId }

  // Show confirmation popup
  function showConfirm(message, onYes) {
    confirmMessage.textContent = message;
    confirmOverlay.style.display = "flex";

    function cleanup() {
      confirmOverlay.style.display = "none";
      confirmYes.removeEventListener("click", yesHandler);
      confirmNo.removeEventListener("click", noHandler);
    }

    function yesHandler() {
      cleanup();
      onYes();
    }
    function noHandler() {
      cleanup();
    }

    confirmYes.addEventListener("click", yesHandler);
    confirmNo.addEventListener("click", noHandler);
  }

  // Render data entries
  function renderData(docs) {
    dataList.innerHTML = "";
    if (docs.length === 0) {
      dataList.innerHTML = "<p>No data found.</p>";
      return;
    }
    docs.forEach(doc => {
      const d = doc.data();
      const id = doc.id;

      const row = document.createElement("div");
      row.className = "data-row";

      // Content grid
      const content = document.createElement("div");
      content.className = "data-content";

      // List all keys and values
      [
        ["IP Address", d.ip],
        ["Browser", d.userAgent],
        ["Platform", d.platform],
        ["OS", d.os],
        ["Screen Resolution", d.screenRes],
        ["Language", d.language],
        ["Timezone", d.timezone],
        ["Date/Time", new Date(d.dateTime).toLocaleString()],
        ["Referrer", d.referrer]
      ].forEach(([key, val]) => {
        const keyDiv = document.createElement("div");
        keyDiv.textContent = key + ":";
        const valDiv = document.createElement("div");
        valDiv.textContent = val || "-";
        content.appendChild(keyDiv);
        content.appendChild(valDiv);
      });

      row.appendChild(content);

      // Delete button
      const delBtn = document.createElement("button");
      delBtn.textContent = "Delete";
      delBtn.className = "delete-btn";
      delBtn.addEventListener("click", () => {
        showConfirm("Are you sure you want to delete this entry?", () => {
          deleteEntry(id);
        });
      });

      row.appendChild(delBtn);

      dataList.appendChild(row);
    });
  }

  // Fetch and display data
  async function fetchData() {
    const snapshot = await collectionRef.get();
    renderData(snapshot.docs);
  }

  // Delete single entry
  async function deleteEntry(id) {
    try {
      await collectionRef.doc(id).delete();
      await fetchData();
    } catch (err) {
      alert("Error deleting entry: " + err.message);
    }
  }

  // Delete all entries
  async function deleteAllEntries() {
    try {
      const snapshot = await collectionRef.get();
      const batch = db.batch();
      snapshot.docs.forEach(doc => {
        batch.delete(doc.ref);
      });
      await batch.commit();
      await fetchData();
    } catch (err) {
      alert("Error deleting all entries: " + err.message);
    }
  }

  deleteAllBtn.addEventListener("click", () => {
    showConfirm("Are you sure you want to delete ALL entries?", () => {
      deleteAllEntries();
    });
  });

  // Initial fetch
  fetchData();
</script>
</body>
</html>
