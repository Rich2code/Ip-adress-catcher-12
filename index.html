<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Welcome</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    max-width: 600px;
    margin: 3rem auto;
    padding: 1rem;
    background: #f0f4ff;
    color: #222;
    text-align: center;
  }
  h1 {
    font-weight: 700;
    margin-bottom: 1rem;
  }
  p {
    font-size: 1.1rem;
  }
</style>
</head>
<body>

<h1>Welcome to Our Site!</h1>
<p>We are collecting some info to improve your experience.</p>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyApoNEdlKTIhjYyCTQTjhkdsIotxs3YaKU",
    authDomain: "ip--address-catcher-12.firebaseapp.com",
    databaseURL: "https://ip--address-catcher-12-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "ip--address-catcher-12",
    storageBucket: "ip--address-catcher-12.firebasestorage.app",
    messagingSenderId: "1049666257395",
    appId: "1:1049666257395:web:a2e4418ea89ecf59511286",
    measurementId: "G-J30PRNTW1M"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // Function to get IP address from a public API
  async function getIpAddress() {
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      return data.ip || 'Unknown';
    } catch {
      return 'Unknown';
    }
  }

  async function collectAndSaveUserData() {
    const ip = await getIpAddress();
    const userAgent = navigator.userAgent || 'Unknown';
    const platform = navigator.platform || 'Unknown';
    const language = navigator.language || 'Unknown';
    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Unknown';
    const screenRes = `${window.screen.width}x${window.screen.height}`;
    const referrer = document.referrer || 'Direct';
    const os = (() => {
      const ua = userAgent.toLowerCase();
      if (ua.includes('windows')) return 'Windows';
      if (ua.includes('macintosh') || ua.includes('mac os')) return 'Mac OS';
      if (ua.includes('linux')) return 'Linux';
      if (/iphone|ipad|ipod/.test(ua)) return 'iOS';
      if (/android/.test(ua)) return 'Android';
      return 'Unknown';
    })();

    try {
      await addDoc(collection(db, "userData"), {
        ip,
        userAgent,
        platform,
        language,
        timezone,
        screenRes,
        referrer,
        os,
        dateTime: serverTimestamp()
      });
      console.log("User data saved successfully");
    } catch (error) {
      console.error("Error saving user data:", error);
    }
  }

  collectAndSaveUserData();
</script>

</body>
</html>
